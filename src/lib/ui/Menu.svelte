<script lang="ts">
	import { easeEmphasizedAccel, easeEmphasizedDecel } from "m3-svelte";
	import { createFloatingActions } from "svelte-floating-ui";
	import { type Snippet } from "svelte";
	import { offset, shift, flip, type Placement } from "@floating-ui/dom";
	import { slide } from "svelte/transition";

	interface Props {
		children?: Snippet<[]>;
		content?: Snippet<[(open: boolean) => void, boolean]>; // (setOpen, open)
		menu: Snippet<[]>;
		placement?: Placement;
		open?: boolean;
		className?: string;
		wrapperClassName?: string;
	}

	let {
		children,
		content,
		menu,
		placement = "bottom",
		open = $bindable(false),
		className,
		wrapperClassName,
	}: Props = $props();

	const [floatingRef, floatingContent] = createFloatingActions({
		strategy: "absolute",
		placement,
		middleware: [offset(6), flip(), shift()],
	});
</script>

<div class="flex {wrapperClassName}" use:floatingRef>
	{@render children?.()}
	{@render content?.(v => (open = v), open)}
</div>

{#if open}
	<div
		class="w-max absolute bg-surface-container z-50 grid grid-flow-row rounded py-2 max-h-[300px] overflow-y-auto shadow-lg {className}"
		style="left: 0; top: 0;"
		aria-haspopup="menu"
		in:slide={{ duration: 200, easing: easeEmphasizedDecel, axis: "y" }}
		out:slide={{ duration: 200, easing: easeEmphasizedAccel, axis: "y" }}
		use:floatingContent
	>
		{@render menu()}
	</div>
{/if}
